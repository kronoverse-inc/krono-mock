!function(e){function t(t){for(var i,a,r=t[0],l=t[1],c=t[2],g=0,d=[];g<r.length;g++)a=r[g],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&d.push(o[a][0]),o[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(h&&h(t);d.length;)d.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,r=1;r<n.length;r++){var l=n[r];0!==o[l]&&(i=!1)}i&&(s.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},o={0:0},s=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/wallet";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var h=l;s.push([63,1,4,2,3,5]),n()}({101:function(e,t){},103:function(e,t){},29:function(e,t){e.exports=fetch},57:function(e,t){e.exports=Run},63:function(e,t,n){e.exports=n(64)},64:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(65);function o(){Array.from(document.getElementsByClassName("panel")).forEach(e=>e.style.display="none")}document.addEventListener("DOMContentLoaded",async e=>{var t,n;console.log("LOADED");const s=new i.WalletService;s.on("show",e=>{console.log("SHOW:",e),function(e){o();const t=document.getElementById(e);t&&(t.style.display="block")}(e)}),s.on("hide",e=>{o()});try{await s.init()}catch(e){console.log(e)}null===(t=document.getElementById("login-btn"))||void 0===t||t.addEventListener("click",e=>{var t,n;const i=null===(t=document.getElementById("l-handle"))||void 0===t?void 0:t.value,o=null===(n=document.getElementById("l-password"))||void 0===n?void 0:n.value;s.login(i,o)}),null===(n=document.getElementById("register-btn"))||void 0===n||n.addEventListener("click",e=>{var t,n,i;const o=null===(t=document.getElementById("r-handle"))||void 0===t?void 0:t.value,a=null===(n=document.getElementById("r-email"))||void 0===n?void 0:n.value,r=null===(i=document.getElementById("r-password"))||void 0===i?void 0:i.value;s.register(o,r,a)});const a=document.createElement("h1");document.body.appendChild(a)})},65:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.WalletService=void 0;const i=n(16),o=n(115),s=n(116),a=n(119),r=n(120),l=n(127),c=n(128),h=n(21),g=n(129),d=n(7),u=n(133),f=n(57);let p={};const m=window.location.href.split("?");if(m[1]){const[e]=m[1].split("#");p=s.decode(e)}i.Constants.Default="main"===o.config.network?i.Constants.Mainnet:i.Constants.Testnet;const y=n(16);y.Constants.Default=i.Constants.Default,console.log("LOAD");class w extends d.EventEmitter{constructor(){super(),this.printLog=console.log.bind(console),this.printError=console.error.bind(console),this.logId=0,this.logs=[],this.sessionId=`${Date.now()}-${Math.random()*Number.MAX_SAFE_INTEGER}`,this.timeLabels={},this.apiUrl=p.apiUrl||o.config.apiUrl,this.domain=document.location.hash.slice(1).split("@")[1],this.overrideConsole(),this.auth=new g.KronoAuth(this.apiUrl,this.domain,o.config.network)}get channel(){const e=window.vuplex;return e||window}get channelScope(){const e=document.referrer;return e&&!this.isInUnity?e.match(/^.+:\/\/[^\/]+/)[0]:null}get isInUnity(){return!!window.vuplex}get handle(){return window.localStorage.getItem("HANDLE")||""}set handle(e){window.localStorage.setItem("HANDLE",e)}get keyPair(){const e=window.localStorage.getItem("WIF");return e?i.KeyPair.fromPrivKey(i.PrivKey.fromString(e)):null}set keyPair(e){window.localStorage.setItem("WIF",e.privKey.toString())}get agentId(){return document.location.hash.slice(1).split("@")[0]}get paymail(){return`${this.handle}@${this.domain}`}async init(){console.log("INIT");let e=!1;for(;o.config.ephemeral&&!e;){await new Promise(e=>setTimeout(()=>e(),5e3));const t=await fetch(this.apiUrl+"/initialize");e=t.ok&&await t.json()}this.clientEmit("WALLET_READY"),this.channel.addEventListener("message",this.onClientEvent.bind(this)),console.log("BLOCKCHAIN:",this.apiUrl);const t=`${this.apiUrl}/agents/${this.domain}/${this.agentId}`;console.log("fetching:",t);const n=await fetch(t);if(!n.ok)throw new Error(`${n.status} - ${n.statusText}`);if(this.agentDef=await n.json(),!this.agentDef)throw new Error("AGENT MISSING");if(o.config.errorLog&&setInterval(async()=>{const e=this.logs;if(this.logs=[],!e.length)return;const t=await fetch(o.config.errorLog,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`${t.status} - ${t.statusText}`)},5e3),this.agentDef.anonymous)return this.initializeWallet();if(!o.config.ephemeral&&!this.keyPair)return this.clientEmit("NO_KEYS");try{await this.initializeUser()}catch(e){console.error("Login Error:",e.message),this.clientEmit("NO_KEYS")}}async initializeWallet(t,n){const i=new f.LocalCache({maxSizeMB:100}),s=new r.RestBlockchain(this.apiUrl,o.config.network,i),g=new f({network:o.config.network,owner:t,blockchain:s,purse:n,cache:new l.RestStateCache(this.apiUrl,i),app:o.config.app||"kronoverse",trust:"*",timeout:6e4,logger:{error:console.error}}),d=this.wallet=new a.Wallet(this.paymail,this.keyPair,g),p=new c.IORedisMock,m=[this.keyPair.pubKey.toString()];let w;o.config.sockets&&(console.log("Sockets:",o.config.sockets),w=new u.WSClient(WebSocket,o.config.sockets,m)),console.log("DOMAIN:",this.domain),console.log("AGENT_ID:",this.agentId),console.log("LOC:",this.agentDef.location);const v=await g.load(this.agentDef.location),E=this.agent=new v(d,s,p,y,{fetch:fetch,Buffer:e,ws:w,SignedMessage:h.SignedMessage});E.on("client",this.clientEmit.bind(this)),E.on("subscribe",(e,t)=>{w.subscribe(e,t)}),E.on("unsubscribe",e=>{w.unsubscribe(e)}),await E.init(),this.clientEmit("AGENT_LOADED"),w.on("jig",(e,t)=>{console.log("JIG:",JSON.stringify(e)),E.onJig(e).catch(console.error)}),w.on("msg",(e,t)=>{console.log("MSG:",JSON.stringify(e)),E.onMessage(new h.SignedMessage(e)).catch(console.error)})}async initializeUser(e){let t;if(console.log("Initializing User"),e&&(this.handle=e),o.config.ephemeral)t=i.Bip32.fromRandom(),this.keyPair=i.KeyPair.fromPrivKey(t.privKey);else{console.log("Recovering account");const e=await this.auth.recover(this.paymail,this.keyPair);t=i.Bip32.fromString(e)}this.initializeWallet(t.derive("m/1/0").privKey.toString(),t.derive("m/0/0").privKey.toString())}async login(e,t){this.keyPair=await this.auth.login(e,t),await this.initializeUser(e)}async register(e,t,n){this.keyPair=await this.auth.register(e,t,n),await this.initializeUser(e)}async logout(){window.localStorage.removeItem("WIF"),window.localStorage.removeItem("HANDLE")}async onClientEvent(e){var t;const n={};if(!this.tryParseMessageData(e.data,n))return;["Register","Login"].includes(n.name)?console.log("WALLET RECEIVED EVENT:",n.name):console.log("WALLET RECEIVED EVENT:",JSON.stringify(n));const i={name:"On"+n.name};try{const e=n.payload&&JSON.parse(n.payload);switch(n.name){case"Register":await this.register(e.handle,e.password,e.email);break;case"Login":await this.login(e.handle,e.password);break;case"Logout":await this.logout();break;case"Cashout":if(!this.wallet)throw new Error("Wallet not initialized");this.clientEmit("BalanceUpdated",0);break;case"IsHandleAvailable":i.payload=JSON.stringify(await this.auth.isHandleAvailable(e));break;default:if(!this.agent)throw new Error("Agent not initialized");const o=await(null===(t=this.agent)||void 0===t?void 0:t.onEvent(n.name,e));i.payload=o&&JSON.stringify(o)}i.success=!0}catch(e){i.success=!1,i.payload=JSON.stringify(e.message),e.message.includes("Not enough funds")?i.statusCode=402:i.statusCode=e.status||500}console.log(i.name,i.payload),this.postMessage(i)}tryParseMessageData(t,n){const i=n||{};return"string"==typeof t?Object.assign(i,JSON.parse(e.from(t,"base64").toString())):"object"==typeof t&&Object.assign(i,t),i&&i.name}clientEmit(e,t){const n={name:e,payload:t&&JSON.stringify(t),success:!0};this.logs.push({idx:this.logId++,sessionId:this.sessionId,handle:this.handle,type:"log",ts:Date.now(),message:{name:e,payload:t}}),this.postMessage(n)}postMessage(e){e.target="kronoverse",this.isInUnity?this.channel.postMessage(e):this.channelScope&&this.channel.parent.postMessage(e,this.channelScope)}overrideConsole(){console.log=(...e)=>{e.unshift(Date.now());const t=e.join(" ");this.logs.push({idx:this.logId++,sessionId:this.sessionId,paymail:this.paymail,type:"log",ts:Date.now(),message:t}),o.config.emitLogs&&this.clientEmit("Log",t),this.printLog(...e)},console.error=(...e)=>{e.unshift(Date.now());const t=e.join(" ");this.logs.push({idx:this.logId++,sessionId:this.sessionId,paymail:this.paymail,type:"error",ts:Date.now(),message:t}),o.config.emitLogs&&this.clientEmit("Error",t),this.printError(...e)},console.time=e=>{this.timeLabels[e]=Date.now()},console.timeEnd=e=>{console.log(`${e}: ${Date.now()-this.timeLabels[e]||0}ms`)}}}t.WalletService=w}).call(this,n(3).Buffer)},68:function(e,t){},71:function(e,t){},72:function(e,t){},88:function(e,t){},90:function(e,t){}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZmV0Y2hcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJSdW5cIiIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3NlcnZpY2VzL3dhbGxldC1zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbIndlYnBhY2tKc29ucENhbGxiYWNrIiwiZGF0YSIsIm1vZHVsZUlkIiwiY2h1bmtJZCIsImNodW5rSWRzIiwibW9yZU1vZHVsZXMiLCJleGVjdXRlTW9kdWxlcyIsImkiLCJyZXNvbHZlcyIsImxlbmd0aCIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImluc3RhbGxlZENodW5rcyIsInB1c2giLCJtb2R1bGVzIiwicGFyZW50SnNvbnBGdW5jdGlvbiIsInNoaWZ0IiwiZGVmZXJyZWRNb2R1bGVzIiwiYXBwbHkiLCJjaGVja0RlZmVycmVkTW9kdWxlcyIsInJlc3VsdCIsImRlZmVycmVkTW9kdWxlIiwiZnVsZmlsbGVkIiwiaiIsImRlcElkIiwic3BsaWNlIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsInMiLCJpbnN0YWxsZWRNb2R1bGVzIiwiMCIsImV4cG9ydHMiLCJtb2R1bGUiLCJsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInAiLCJqc29ucEFycmF5Iiwid2luZG93Iiwib2xkSnNvbnBGdW5jdGlvbiIsInNsaWNlIiwiZmV0Y2giLCJSdW4iLCJ3YWxsZXRfc2VydmljZV8xIiwiaGlkZSIsIkFycmF5IiwiZnJvbSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImZvckVhY2giLCJzdHlsZSIsImRpc3BsYXkiLCJhZGRFdmVudExpc3RlbmVyIiwiYXN5bmMiLCJldmVudCIsIl9hIiwiX2IiLCJjb25zb2xlIiwibG9nIiwid2FsbGV0IiwiV2FsbGV0U2VydmljZSIsIm9uIiwicGFuZWwiLCJwYW5lbEVsZW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInNob3ciLCJpbml0IiwiZXJyIiwiZSIsImhhbmRsZSIsInBhc3N3b3JkIiwibG9naW4iLCJfYyIsImVtYWlsIiwicmVnaXN0ZXIiLCJlbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImJzdl8xIiwibm9kZV9jb25maWdfdHNfMSIsInF1ZXJ5c3RyaW5nIiwid2FsbGV0XzEiLCJyZXN0X2Jsb2NrY2hhaW5fMSIsInJlc3Rfc3RhdGVfY2FjaGVfMSIsImlvcmVkaXNfbW9ja18xIiwic2lnbmVkX21lc3NhZ2VfMSIsImF1dGhfMSIsImV2ZW50c18xIiwid3NfY2xpZW50XzEiLCJxdWVyeVBhcmFtcyIsInVybFBhcnRzIiwibG9jYXRpb24iLCJocmVmIiwic3BsaXQiLCJxdWVyeSIsImRlY29kZSIsIkNvbnN0YW50cyIsIkRlZmF1bHQiLCJjb25maWciLCJuZXR3b3JrIiwiTWFpbm5ldCIsIlRlc3RuZXQiLCJic3YiLCJFdmVudEVtaXR0ZXIiLCJzdXBlciIsInRoaXMiLCJwcmludExvZyIsInByaW50RXJyb3IiLCJlcnJvciIsImxvZ0lkIiwibG9ncyIsInNlc3Npb25JZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwiTnVtYmVyIiwiTUFYX1NBRkVfSU5URUdFUiIsInRpbWVMYWJlbHMiLCJhcGlVcmwiLCJkb21haW4iLCJoYXNoIiwib3ZlcnJpZGVDb25zb2xlIiwiYXV0aCIsIktyb25vQXV0aCIsInYiLCJ2dXBsZXgiLCJyZWYiLCJyZWZlcnJlciIsImlzSW5Vbml0eSIsIm1hdGNoIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInNldEl0ZW0iLCJ3aWYiLCJLZXlQYWlyIiwiZnJvbVByaXZLZXkiLCJQcml2S2V5IiwiZnJvbVN0cmluZyIsImtleVBhaXIiLCJwcml2S2V5IiwidG9TdHJpbmciLCJpbml0aWFsaXplZCIsImVwaGVtZXJhbCIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInJlc3AiLCJvayIsImpzb24iLCJjbGllbnRFbWl0IiwiY2hhbm5lbCIsIm9uQ2xpZW50RXZlbnQiLCJ1cmwiLCJhZ2VudElkIiwiRXJyb3IiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiYWdlbnREZWYiLCJlcnJvckxvZyIsInNldEludGVydmFsIiwibWV0aG9kIiwiaGVhZGVycyIsIkpTT04iLCJzdHJpbmdpZnkiLCJhbm9ueW1vdXMiLCJpbml0aWFsaXplV2FsbGV0IiwiaW5pdGlhbGl6ZVVzZXIiLCJtZXNzYWdlIiwib3duZXIiLCJwdXJzZSIsImNhY2hlIiwiTG9jYWxDYWNoZSIsIm1heFNpemVNQiIsImJsb2NrY2hhaW4iLCJSZXN0QmxvY2tjaGFpbiIsInJ1biIsIlJlc3RTdGF0ZUNhY2hlIiwiYXBwIiwidHJ1c3QiLCJ0aW1lb3V0IiwibG9nZ2VyIiwiV2FsbGV0IiwicGF5bWFpbCIsInN0b3JhZ2UiLCJJT1JlZGlzTW9jayIsImNoYW5uZWxzIiwicHViS2V5Iiwid3MiLCJzb2NrZXRzIiwiV1NDbGllbnQiLCJXZWJTb2NrZXQiLCJBZ2VudCIsImxvYWQiLCJhZ2VudCIsIkJ1ZmZlciIsIlNpZ25lZE1lc3NhZ2UiLCJsYXN0SWQiLCJzdWJzY3JpYmUiLCJ1bnN1YnNjcmliZSIsImppZyIsIm9uSmlnIiwiY2F0Y2giLCJvbk1lc3NhZ2UiLCJiaXAzMiIsIkJpcDMyIiwiZnJvbVJhbmRvbSIsInhwcml2IiwicmVjb3ZlciIsImRlcml2ZSIsInJlbW92ZUl0ZW0iLCJ0cnlQYXJzZU1lc3NhZ2VEYXRhIiwiaW5jbHVkZXMiLCJyZXNwb25zZSIsInBheWxvYWQiLCJwYXJzZSIsImxvZ291dCIsImlzSGFuZGxlQXZhaWxhYmxlIiwib25FdmVudCIsInN1Y2Nlc3MiLCJzdGF0dXNDb2RlIiwicG9zdE1lc3NhZ2UiLCJvdXRCeVJlZiIsImFzc2lnbiIsImlkeCIsInR5cGUiLCJ0cyIsInRhcmdldCIsImNoYW5uZWxTY29wZSIsInBhcmVudCIsIm1lc3NhZ2VzIiwidW5zaGlmdCIsImpvaW4iLCJlbWl0TG9ncyIsInRpbWUiLCJsYWJlbCIsInRpbWVFbmQiXSwibWFwcGluZ3MiOiJhQUNFLFNBQVNBLEVBQXFCQyxHQVE3QixJQVBBLElBTUlDLEVBQVVDLEVBTlZDLEVBQVdILEVBQUssR0FDaEJJLEVBQWNKLEVBQUssR0FDbkJLLEVBQWlCTCxFQUFLLEdBSUhNLEVBQUksRUFBR0MsRUFBVyxHQUNwQ0QsRUFBSUgsRUFBU0ssT0FBUUYsSUFDekJKLEVBQVVDLEVBQVNHLEdBQ2hCRyxPQUFPQyxVQUFVQyxlQUFlQyxLQUFLQyxFQUFpQlgsSUFBWVcsRUFBZ0JYLElBQ3BGSyxFQUFTTyxLQUFLRCxFQUFnQlgsR0FBUyxJQUV4Q1csRUFBZ0JYLEdBQVcsRUFFNUIsSUFBSUQsS0FBWUcsRUFDWkssT0FBT0MsVUFBVUMsZUFBZUMsS0FBS1IsRUFBYUgsS0FDcERjLEVBQVFkLEdBQVlHLEVBQVlILElBS2xDLElBRkdlLEdBQXFCQSxFQUFvQmhCLEdBRXRDTyxFQUFTQyxRQUNkRCxFQUFTVSxPQUFUVixHQU9ELE9BSEFXLEVBQWdCSixLQUFLSyxNQUFNRCxFQUFpQmIsR0FBa0IsSUFHdkRlLElBRVIsU0FBU0EsSUFFUixJQURBLElBQUlDLEVBQ0lmLEVBQUksRUFBR0EsRUFBSVksRUFBZ0JWLE9BQVFGLElBQUssQ0FHL0MsSUFGQSxJQUFJZ0IsRUFBaUJKLEVBQWdCWixHQUNqQ2lCLEdBQVksRUFDUkMsRUFBSSxFQUFHQSxFQUFJRixFQUFlZCxPQUFRZ0IsSUFBSyxDQUM5QyxJQUFJQyxFQUFRSCxFQUFlRSxHQUNHLElBQTNCWCxFQUFnQlksS0FBY0YsR0FBWSxHQUUzQ0EsSUFDRkwsRUFBZ0JRLE9BQU9wQixJQUFLLEdBQzVCZSxF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VkUsVUFBV04sS0FBS00sVUFDaEJ3RSxRQUFTOUUsS0FBSzhFLFFBQ2QwQyxLQUFNLE1BQ05DLEdBQUlsSCxLQUFLQyxNQUNUdUQsWUFFQXpGLEVBQWlCbUIsT0FBT3VJLFVBQ3hCaEksS0FBSzZDLFdBQVcsTUFBT2tCLEdBQzNCL0QsS0FBS0MsWUFBWTRILElBRXJCOUssUUFBUW9ELE1BQVEsSUFBSTBILEtBQ2hCQSxFQUFTQyxRQUFRdkgsS0FBS0MsT0FDdEIsTUFBTXVELEVBQVU4RCxFQUFTRSxLQUFLLEtBQzlCL0gsS0FBS0ssS0FBS3RILEtBQUssQ0FDWHdPLElBQUt2SCxLQUFLSSxRQUNWRSxVQUFXTixLQUFLTSxVQUNoQndFLFFBQVM5RSxLQUFLOEUsUUFDZDBDLEtBQU0sUUFDTkMsR0FBSWxILEtBQUtDLE1BQ1R1RCxZQUVBekYsRUFBaUJtQixPQUFPdUksVUFDeEJoSSxLQUFLNkMsV0FBVyxRQUFTa0IsR0FDN0IvRCxLQUFLRSxjQUFjMkgsSUFFdkI5SyxRQUFRa0wsS0FBUUMsSUFDWmxJLEtBQUthLFdBQVdxSCxHQUFTM0gsS0FBS0MsT0FFbEN6RCxRQUFRb0wsUUFBV0QsSUFDZm5MLFFBQVFDLElBQUksR0FBR2tMLE1BQVUzSCxLQUFLQyxNQUFRUixLQUFLYSxXQUFXcUgsSUFBVSxTQUk1RWxPLEVBQVFrRCxjQUFnQkEsSSIsImZpbGUiOiJhcHB+ZTJlOTM1OTIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbiBcdGZ1bmN0aW9uIHdlYnBhY2tKc29ucENhbGxiYWNrKGRhdGEpIHtcbiBcdFx0dmFyIGNodW5rSWRzID0gZGF0YVswXTtcbiBcdFx0dmFyIG1vcmVNb2R1bGVzID0gZGF0YVsxXTtcbiBcdFx0dmFyIGV4ZWN1dGVNb2R1bGVzID0gZGF0YVsyXTtcblxuIFx0XHQvLyBhZGQgXCJtb3JlTW9kdWxlc1wiIHRvIHRoZSBtb2R1bGVzIG9iamVjdCxcbiBcdFx0Ly8gdGhlbiBmbGFnIGFsbCBcImNodW5rSWRzXCIgYXMgbG9hZGVkIGFuZCBmaXJlIGNhbGxiYWNrXG4gXHRcdHZhciBtb2R1bGVJZCwgY2h1bmtJZCwgaSA9IDAsIHJlc29sdmVzID0gW107XG4gXHRcdGZvcig7aSA8IGNodW5rSWRzLmxlbmd0aDsgaSsrKSB7XG4gXHRcdFx0Y2h1bmtJZCA9IGNodW5rSWRzW2ldO1xuIFx0XHRcdGlmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpICYmIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSkge1xuIFx0XHRcdFx0cmVzb2x2ZXMucHVzaChpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF1bMF0pO1xuIFx0XHRcdH1cbiBcdFx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuIFx0XHR9XG4gXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuIFx0XHRcdGlmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG4gXHRcdFx0XHRtb2R1bGVzW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcbiBcdFx0XHR9XG4gXHRcdH1cbiBcdFx0aWYocGFyZW50SnNvbnBGdW5jdGlvbikgcGFyZW50SnNvbnBGdW5jdGlvbihkYXRhKTtcblxuIFx0XHR3aGlsZShyZXNvbHZlcy5sZW5ndGgpIHtcbiBcdFx0XHRyZXNvbHZlcy5zaGlmdCgpKCk7XG4gXHRcdH1cblxuIFx0XHQvLyBhZGQgZW50cnkgbW9kdWxlcyBmcm9tIGxvYWRlZCBjaHVuayB0byBkZWZlcnJlZCBsaXN0XG4gXHRcdGRlZmVycmVkTW9kdWxlcy5wdXNoLmFwcGx5KGRlZmVycmVkTW9kdWxlcywgZXhlY3V0ZU1vZHVsZXMgfHwgW10pO1xuXG4gXHRcdC8vIHJ1biBkZWZlcnJlZCBtb2R1bGVzIHdoZW4gYWxsIGNodW5rcyByZWFkeVxuIFx0XHRyZXR1cm4gY2hlY2tEZWZlcnJlZE1vZHVsZXMoKTtcbiBcdH07XG4gXHRmdW5jdGlvbiBjaGVja0RlZmVycmVkTW9kdWxlcygpIHtcbiBcdFx0dmFyIHJlc3VsdDtcbiBcdFx0Zm9yKHZhciBpID0gMDsgaSA8IGRlZmVycmVkTW9kdWxlcy5sZW5ndGg7IGkrKykge1xuIFx0XHRcdHZhciBkZWZlcnJlZE1vZHVsZSA9IGRlZmVycmVkTW9kdWxlc1tpXTtcbiBcdFx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcbiBcdFx0XHRmb3IodmFyIGogPSAxOyBqIDwgZGVmZXJyZWRNb2R1bGUubGVuZ3RoOyBqKyspIHtcbiBcdFx0XHRcdHZhciBkZXBJZCA9IGRlZmVycmVkTW9kdWxlW2pdO1xuIFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtzW2RlcElkXSAhPT0gMCkgZnVsZmlsbGVkID0gZmFsc2U7XG4gXHRcdFx0fVxuIFx0XHRcdGlmKGZ1bGZpbGxlZCkge1xuIFx0XHRcdFx0ZGVmZXJyZWRNb2R1bGVzLnNwbGljZShpLS0sIDEpO1xuIFx0XHRcdFx0cmVzdWx0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSBkZWZlcnJlZE1vZHVsZVswXSk7XG4gXHRcdFx0fVxuIFx0XHR9XG5cbiBcdFx0cmV0dXJuIHJlc3VsdDtcbiBcdH1cblxuIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gb2JqZWN0IHRvIHN0b3JlIGxvYWRlZCBhbmQgbG9hZGluZyBjaHVua3NcbiBcdC8vIHVuZGVmaW5lZCA9IGNodW5rIG5vdCBsb2FkZWQsIG51bGwgPSBjaHVuayBwcmVsb2FkZWQvcHJlZmV0Y2hlZFxuIFx0Ly8gUHJvbWlzZSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbiBcdHZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG4gXHRcdDA6IDBcbiBcdH07XG5cbiBcdHZhciBkZWZlcnJlZE1vZHVsZXMgPSBbXTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCIvd2FsbGV0XCI7XG5cbiBcdHZhciBqc29ucEFycmF5ID0gd2luZG93W1wid2VicGFja0pzb25wXCJdID0gd2luZG93W1wid2VicGFja0pzb25wXCJdIHx8IFtdO1xuIFx0dmFyIG9sZEpzb25wRnVuY3Rpb24gPSBqc29ucEFycmF5LnB1c2guYmluZChqc29ucEFycmF5KTtcbiBcdGpzb25wQXJyYXkucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrO1xuIFx0anNvbnBBcnJheSA9IGpzb25wQXJyYXkuc2xpY2UoKTtcbiBcdGZvcih2YXIgaSA9IDA7IGkgPCBqc29ucEFycmF5Lmxlbmd0aDsgaSsrKSB3ZWJwYWNrSnNvbnBDYWxsYmFjayhqc29ucEFycmF5W2ldKTtcbiBcdHZhciBwYXJlbnRKc29ucEZ1bmN0aW9uID0gb2xkSnNvbnBGdW5jdGlvbjtcblxuXG4gXHQvLyBhZGQgZW50cnkgbW9kdWxlIHRvIGRlZmVycmVkIGxpc3RcbiBcdGRlZmVycmVkTW9kdWxlcy5wdXNoKFs2MywxLDQsMiwzLDVdKTtcbiBcdC8vIHJ1biBkZWZlcnJlZCBtb2R1bGVzIHdoZW4gcmVhZHlcbiBcdHJldHVybiBjaGVja0RlZmVycmVkTW9kdWxlcygpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmZXRjaDsiLCJtb2R1bGUuZXhwb3J0cyA9IFJ1bjsiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IHdhbGxldF9zZXJ2aWNlXzEgPSByZXF1aXJlKFwiLi9zZXJ2aWNlcy93YWxsZXQtc2VydmljZVwiKTtcbi8vIGltcG9ydCB7IGNvbmZpZyB9IGZyb20gJ25vZGUtY29uZmlnLXRzJztcbmZ1bmN0aW9uIGhpZGUoKSB7XG4gICAgQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwYW5lbCcpKVxuICAgICAgICAuZm9yRWFjaCgocCkgPT4gcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnKTtcbn1cbmZ1bmN0aW9uIHNob3cocGFuZWwpIHtcbiAgICBoaWRlKCk7XG4gICAgY29uc3QgcGFuZWxFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocGFuZWwpO1xuICAgIGlmIChwYW5lbEVsZW1lbnQpIHtcbiAgICAgICAgcGFuZWxFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIH1cbn1cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGNvbnNvbGUubG9nKCdMT0FERUQnKTtcbiAgICBjb25zdCB3YWxsZXQgPSBuZXcgd2FsbGV0X3NlcnZpY2VfMS5XYWxsZXRTZXJ2aWNlKCk7XG4gICAgd2FsbGV0Lm9uKCdzaG93JywgKHBhbmVsKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTSE9XOicsIHBhbmVsKTtcbiAgICAgICAgc2hvdyhwYW5lbCk7XG4gICAgfSk7XG4gICAgd2FsbGV0Lm9uKCdoaWRlJywgKHBhbmVsKSA9PiB7XG4gICAgICAgIGhpZGUoKTtcbiAgICB9KTtcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCB3YWxsZXQuaW5pdCgpO1xuICAgIH1cbiAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfVxuICAgIChfYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1idG4nKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgY29uc3QgaGFuZGxlID0gKF9hID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2wtaGFuZGxlJykpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS52YWx1ZTtcbiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSAoX2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbC1wYXNzd29yZCcpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudmFsdWU7XG4gICAgICAgIHdhbGxldC5sb2dpbihoYW5kbGUsIHBhc3N3b3JkKTtcbiAgICB9KTtcbiAgICAoX2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVnaXN0ZXItYnRuJykpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICBjb25zdCBoYW5kbGUgPSAoX2EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnci1oYW5kbGUnKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZhbHVlO1xuICAgICAgICBjb25zdCBlbWFpbCA9IChfYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyLWVtYWlsJykpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi52YWx1ZTtcbiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSAoX2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnci1wYXNzd29yZCcpKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudmFsdWU7XG4gICAgICAgIHdhbGxldC5yZWdpc3RlcihoYW5kbGUsIHBhc3N3b3JkLCBlbWFpbCk7XG4gICAgfSk7XG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XG4gICAgLy8gZWxlbWVudC5pbm5lckhUTUwgPSBgJHtjb25maWcuY29uZmlnfTogJHtjb25maWcubW9kZX1gO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG59KTtcbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XYWxsZXRTZXJ2aWNlID0gdm9pZCAwO1xuY29uc3QgYnN2XzEgPSByZXF1aXJlKFwiYnN2XCIpO1xuY29uc3Qgbm9kZV9jb25maWdfdHNfMSA9IHJlcXVpcmUoXCJub2RlLWNvbmZpZy10c1wiKTtcbmNvbnN0IHF1ZXJ5c3RyaW5nID0gcmVxdWlyZShcInF1ZXJ5c3RyaW5nXCIpO1xuY29uc3Qgd2FsbGV0XzEgPSByZXF1aXJlKFwiQGtyb25vdmVyc2UvdG9vbHMvbGliL3dhbGxldFwiKTtcbmNvbnN0IHJlc3RfYmxvY2tjaGFpbl8xID0gcmVxdWlyZShcIkBrcm9ub3ZlcnNlL3Rvb2xzL2xpYi9yZXN0LWJsb2NrY2hhaW5cIik7XG5jb25zdCByZXN0X3N0YXRlX2NhY2hlXzEgPSByZXF1aXJlKFwiQGtyb25vdmVyc2UvdG9vbHMvbGliL3N0b3JhZ2UvcmVzdC1zdGF0ZS1jYWNoZVwiKTtcbmNvbnN0IGlvcmVkaXNfbW9ja18xID0gcmVxdWlyZShcIkBrcm9ub3ZlcnNlL3Rvb2xzL2xpYi9pb3JlZGlzLW1vY2tcIik7XG5jb25zdCBzaWduZWRfbWVzc2FnZV8xID0gcmVxdWlyZShcIkBrcm9ub3ZlcnNlL3Rvb2xzL2xpYi9zaWduZWQtbWVzc2FnZVwiKTtcbmNvbnN0IGF1dGhfMSA9IHJlcXVpcmUoXCJAa3Jvbm92ZXJzZS90b29scy9saWIvYXV0aFwiKTtcbmNvbnN0IGV2ZW50c18xID0gcmVxdWlyZShcImV2ZW50c1wiKTtcbmNvbnN0IHdzX2NsaWVudF8xID0gcmVxdWlyZShcIkBrcm9ub3ZlcnNlL3Rvb2xzL2xpYi93cy1jbGllbnRcIik7XG5jb25zdCBSdW4gPSByZXF1aXJlKCdAa3Jvbm92ZXJzZS9ydW4nKTtcbmxldCBxdWVyeVBhcmFtcyA9IHt9O1xuY29uc3QgdXJsUGFydHMgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnPycpO1xuaWYgKHVybFBhcnRzWzFdKSB7XG4gICAgY29uc3QgW3F1ZXJ5XSA9IHVybFBhcnRzWzFdLnNwbGl0KCcjJyk7XG4gICAgcXVlcnlQYXJhbXMgPSBxdWVyeXN0cmluZy5kZWNvZGUocXVlcnkpO1xufVxuYnN2XzEuQ29uc3RhbnRzLkRlZmF1bHQgPSBub2RlX2NvbmZpZ190c18xLmNvbmZpZy5uZXR3b3JrID09PSAnbWFpbicgPyBic3ZfMS5Db25zdGFudHMuTWFpbm5ldCA6IGJzdl8xLkNvbnN0YW50cy5UZXN0bmV0O1xuY29uc3QgYnN2ID0gcmVxdWlyZSgnYnN2Jyk7XG5ic3YuQ29uc3RhbnRzLkRlZmF1bHQgPSBic3ZfMS5Db25zdGFudHMuRGVmYXVsdDtcbmNvbnNvbGUubG9nKCdMT0FEJyk7XG5jbGFzcyBXYWxsZXRTZXJ2aWNlIGV4dGVuZHMgZXZlbnRzXzEuRXZlbnRFbWl0dGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5wcmludExvZyA9IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7XG4gICAgICAgIHRoaXMucHJpbnRFcnJvciA9IGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlKTtcbiAgICAgICAgLy8gcHJpdmF0ZSByZXF1ZXN0U2VydmljZTogUmVxdWVzdFNlcnZpY2U7XG4gICAgICAgIHRoaXMubG9nSWQgPSAwO1xuICAgICAgICB0aGlzLmxvZ3MgPSBbXTtcbiAgICAgICAgdGhpcy5zZXNzaW9uSWQgPSBgJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkgKiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUn1gO1xuICAgICAgICB0aGlzLnRpbWVMYWJlbHMgPSB7fTtcbiAgICAgICAgdGhpcy5hcGlVcmwgPSBxdWVyeVBhcmFtcy5hcGlVcmwgfHwgbm9kZV9jb25maWdfdHNfMS5jb25maWcuYXBpVXJsO1xuICAgICAgICB0aGlzLmRvbWFpbiA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2guc2xpY2UoMSkuc3BsaXQoJ0AnKVsxXTtcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnNvbGUoKTtcbiAgICAgICAgdGhpcy5hdXRoID0gbmV3IGF1dGhfMS5Lcm9ub0F1dGgodGhpcy5hcGlVcmwsIHRoaXMuZG9tYWluLCBub2RlX2NvbmZpZ190c18xLmNvbmZpZy5uZXR3b3JrKTtcbiAgICB9XG4gICAgZ2V0IGNoYW5uZWwoKSB7XG4gICAgICAgIGNvbnN0IHYgPSB3aW5kb3cudnVwbGV4O1xuICAgICAgICByZXR1cm4gKHYpID8gdiA6IHdpbmRvdztcbiAgICB9XG4gICAgZ2V0IGNoYW5uZWxTY29wZSgpIHtcbiAgICAgICAgY29uc3QgcmVmID0gZG9jdW1lbnQucmVmZXJyZXI7XG4gICAgICAgIGlmIChyZWYgJiYgIXRoaXMuaXNJblVuaXR5KSB7XG4gICAgICAgICAgICByZXR1cm4gcmVmLm1hdGNoKC9eLis6XFwvXFwvW15cXC9dKy8pWzBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGlzSW5Vbml0eSgpIHtcbiAgICAgICAgcmV0dXJuICh3aW5kb3cudnVwbGV4KSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG4gICAgZ2V0IGhhbmRsZSgpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnSEFORExFJykgfHwgJyc7XG4gICAgfVxuICAgIHNldCBoYW5kbGUodmFsdWUpIHtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdIQU5ETEUnLCB2YWx1ZSk7XG4gICAgfVxuICAgIGdldCBrZXlQYWlyKCkge1xuICAgICAgICBjb25zdCB3aWYgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ1dJRicpO1xuICAgICAgICBpZiAoIXdpZilcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gYnN2XzEuS2V5UGFpci5mcm9tUHJpdktleShic3ZfMS5Qcml2S2V5LmZyb21TdHJpbmcod2lmKSk7XG4gICAgfVxuICAgIHNldCBrZXlQYWlyKGtleVBhaXIpIHtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdXSUYnLCBrZXlQYWlyLnByaXZLZXkudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGdldCBhZ2VudElkKCkge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQubG9jYXRpb24uaGFzaC5zbGljZSgxKS5zcGxpdCgnQCcpWzBdO1xuICAgIH1cbiAgICBnZXQgcGF5bWFpbCgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuaGFuZGxlfUAke3RoaXMuZG9tYWlufWA7XG4gICAgfVxuICAgIGFzeW5jIGluaXQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdJTklUJyk7XG4gICAgICAgIGxldCBpbml0aWFsaXplZCA9IGZhbHNlO1xuICAgICAgICB3aGlsZSAobm9kZV9jb25maWdfdHNfMS5jb25maWcuZXBoZW1lcmFsICYmICFpbml0aWFsaXplZCkge1xuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQoKCkgPT4gcmVzb2x2ZSgpLCA1MDAwKSk7XG4gICAgICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5hcGlVcmx9L2luaXRpYWxpemVgKTtcbiAgICAgICAgICAgIGluaXRpYWxpemVkID0gcmVzcC5vayAmJiBhd2FpdCByZXNwLmpzb24oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsaWVudEVtaXQoJ1dBTExFVF9SRUFEWScpO1xuICAgICAgICB0aGlzLmNoYW5uZWwuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMub25DbGllbnRFdmVudC5iaW5kKHRoaXMpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ0JMT0NLQ0hBSU46JywgdGhpcy5hcGlVcmwpO1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmFwaVVybH0vYWdlbnRzLyR7dGhpcy5kb21haW59LyR7dGhpcy5hZ2VudElkfWA7XG4gICAgICAgIGNvbnNvbGUubG9nKCdmZXRjaGluZzonLCB1cmwpO1xuICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICAgICAgaWYgKCFyZXNwLm9rKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3Jlc3Auc3RhdHVzfSAtICR7cmVzcC5zdGF0dXNUZXh0fWApO1xuICAgICAgICB0aGlzLmFnZW50RGVmID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICAgIGlmICghdGhpcy5hZ2VudERlZilcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQUdFTlQgTUlTU0lORycpO1xuICAgICAgICBpZiAobm9kZV9jb25maWdfdHNfMS5jb25maWcuZXJyb3JMb2cpIHtcbiAgICAgICAgICAgIHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBsb2dzID0gdGhpcy5sb2dzO1xuICAgICAgICAgICAgICAgIHRoaXMubG9ncyA9IFtdO1xuICAgICAgICAgICAgICAgIGlmICghbG9ncy5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2gobm9kZV9jb25maWdfdHNfMS5jb25maWcuZXJyb3JMb2csIHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShsb2dzKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghcmVzcC5vaylcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3Jlc3Auc3RhdHVzfSAtICR7cmVzcC5zdGF0dXNUZXh0fWApO1xuICAgICAgICAgICAgfSwgNTAwMCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhpcy5lbWl0KCdzaG93JywgJ2xvZ2luJyk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdTSE9XIExPR0lOJyk7XG4gICAgICAgIGlmICh0aGlzLmFnZW50RGVmLmFub255bW91cylcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXRpYWxpemVXYWxsZXQoKTtcbiAgICAgICAgaWYgKCFub2RlX2NvbmZpZ190c18xLmNvbmZpZy5lcGhlbWVyYWwgJiYgIXRoaXMua2V5UGFpcilcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWVudEVtaXQoJ05PX0tFWVMnKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVVzZXIoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignTG9naW4gRXJyb3I6JywgZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIHRoaXMuY2xpZW50RW1pdCgnTk9fS0VZUycpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemVXYWxsZXQob3duZXIsIHB1cnNlKSB7XG4gICAgICAgIGNvbnN0IGNhY2hlID0gbmV3IFJ1bi5Mb2NhbENhY2hlKHsgbWF4U2l6ZU1COiAxMDAgfSk7XG4gICAgICAgIGNvbnN0IGJsb2NrY2hhaW4gPSBuZXcgcmVzdF9ibG9ja2NoYWluXzEuUmVzdEJsb2NrY2hhaW4odGhpcy5hcGlVcmwsIG5vZGVfY29uZmlnX3RzXzEuY29uZmlnLm5ldHdvcmssIGNhY2hlKTtcbiAgICAgICAgY29uc3QgcnVuID0gbmV3IFJ1bih7XG4gICAgICAgICAgICBuZXR3b3JrOiBub2RlX2NvbmZpZ190c18xLmNvbmZpZy5uZXR3b3JrLFxuICAgICAgICAgICAgb3duZXIsXG4gICAgICAgICAgICBibG9ja2NoYWluLFxuICAgICAgICAgICAgcHVyc2UsXG4gICAgICAgICAgICBjYWNoZTogbmV3IHJlc3Rfc3RhdGVfY2FjaGVfMS5SZXN0U3RhdGVDYWNoZSh0aGlzLmFwaVVybCwgY2FjaGUpLFxuICAgICAgICAgICAgYXBwOiBub2RlX2NvbmZpZ190c18xLmNvbmZpZy5hcHAgfHwgJ2tyb25vdmVyc2UnLFxuICAgICAgICAgICAgdHJ1c3Q6ICcqJyxcbiAgICAgICAgICAgIHRpbWVvdXQ6IDYwMDAwLFxuICAgICAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgICAgICAgZXJyb3I6IGNvbnNvbGUuZXJyb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHdhbGxldCA9IHRoaXMud2FsbGV0ID0gbmV3IHdhbGxldF8xLldhbGxldCh0aGlzLnBheW1haWwsIHRoaXMua2V5UGFpciwgcnVuKTtcbiAgICAgICAgY29uc3Qgc3RvcmFnZSA9IG5ldyBpb3JlZGlzX21vY2tfMS5JT1JlZGlzTW9jaygpO1xuICAgICAgICBjb25zdCBjaGFubmVscyA9IFt0aGlzLmtleVBhaXIucHViS2V5LnRvU3RyaW5nKCldO1xuICAgICAgICBsZXQgd3M7XG4gICAgICAgIGlmIChub2RlX2NvbmZpZ190c18xLmNvbmZpZy5zb2NrZXRzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU29ja2V0czonLCBub2RlX2NvbmZpZ190c18xLmNvbmZpZy5zb2NrZXRzKTtcbiAgICAgICAgICAgIHdzID0gbmV3IHdzX2NsaWVudF8xLldTQ2xpZW50KFdlYlNvY2tldCwgbm9kZV9jb25maWdfdHNfMS5jb25maWcuc29ja2V0cywgY2hhbm5lbHMpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCdET01BSU46JywgdGhpcy5kb21haW4pO1xuICAgICAgICBjb25zb2xlLmxvZygnQUdFTlRfSUQ6JywgdGhpcy5hZ2VudElkKTtcbiAgICAgICAgY29uc29sZS5sb2coJ0xPQzonLCB0aGlzLmFnZW50RGVmLmxvY2F0aW9uKTtcbiAgICAgICAgY29uc3QgQWdlbnQgPSBhd2FpdCBydW4ubG9hZCh0aGlzLmFnZW50RGVmLmxvY2F0aW9uKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSB0aGlzLmFnZW50ID0gbmV3IEFnZW50KHdhbGxldCwgYmxvY2tjaGFpbiwgc3RvcmFnZSwgYnN2LCB7IGZldGNoLCBCdWZmZXIsIHdzLCBTaWduZWRNZXNzYWdlOiBzaWduZWRfbWVzc2FnZV8xLlNpZ25lZE1lc3NhZ2UgfSk7XG4gICAgICAgIGFnZW50Lm9uKCdjbGllbnQnLCB0aGlzLmNsaWVudEVtaXQuYmluZCh0aGlzKSk7XG4gICAgICAgIGFnZW50Lm9uKCdzdWJzY3JpYmUnLCAoY2hhbm5lbCwgbGFzdElkKSA9PiB7XG4gICAgICAgICAgICB3cy5zdWJzY3JpYmUoY2hhbm5lbCwgbGFzdElkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGFnZW50Lm9uKCd1bnN1YnNjcmliZScsIChjaGFubmVsKSA9PiB7XG4gICAgICAgICAgICB3cy51bnN1YnNjcmliZShjaGFubmVsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGF3YWl0IGFnZW50LmluaXQoKTtcbiAgICAgICAgdGhpcy5jbGllbnRFbWl0KCdBR0VOVF9MT0FERUQnKTtcbiAgICAgICAgd3Mub24oJ2ppZycsIChqaWcsIGNoYW5uZWwpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdKSUc6JywgSlNPTi5zdHJpbmdpZnkoamlnKSk7XG4gICAgICAgICAgICBhZ2VudC5vbkppZyhqaWcpLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICAgICAgd3Mub24oJ21zZycsIChtZXNzYWdlLCBjaGFubmVsKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTVNHOicsIEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcbiAgICAgICAgICAgIGFnZW50Lm9uTWVzc2FnZShuZXcgc2lnbmVkX21lc3NhZ2VfMS5TaWduZWRNZXNzYWdlKG1lc3NhZ2UpKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemVVc2VyKGhhbmRsZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnSW5pdGlhbGl6aW5nIFVzZXInKTtcbiAgICAgICAgaWYgKGhhbmRsZSlcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlID0gaGFuZGxlO1xuICAgICAgICBsZXQgYmlwMzI7XG4gICAgICAgIGlmIChub2RlX2NvbmZpZ190c18xLmNvbmZpZy5lcGhlbWVyYWwpIHtcbiAgICAgICAgICAgIGJpcDMyID0gYnN2XzEuQmlwMzIuZnJvbVJhbmRvbSgpO1xuICAgICAgICAgICAgdGhpcy5rZXlQYWlyID0gYnN2XzEuS2V5UGFpci5mcm9tUHJpdktleShiaXAzMi5wcml2S2V5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSZWNvdmVyaW5nIGFjY291bnQnKTtcbiAgICAgICAgICAgIGNvbnN0IHhwcml2ID0gYXdhaXQgdGhpcy5hdXRoLnJlY292ZXIodGhpcy5wYXltYWlsLCB0aGlzLmtleVBhaXIpO1xuICAgICAgICAgICAgYmlwMzIgPSBic3ZfMS5CaXAzMi5mcm9tU3RyaW5nKHhwcml2KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluaXRpYWxpemVXYWxsZXQoYmlwMzIuZGVyaXZlKCdtLzEvMCcpLnByaXZLZXkudG9TdHJpbmcoKSwgYmlwMzIuZGVyaXZlKCdtLzAvMCcpLnByaXZLZXkudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGFzeW5jIGxvZ2luKGhhbmRsZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgdGhpcy5rZXlQYWlyID0gYXdhaXQgdGhpcy5hdXRoLmxvZ2luKGhhbmRsZSwgcGFzc3dvcmQpO1xuICAgICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVVc2VyKGhhbmRsZSk7XG4gICAgfVxuICAgIGFzeW5jIHJlZ2lzdGVyKGhhbmRsZSwgcGFzc3dvcmQsIGVtYWlsKSB7XG4gICAgICAgIHRoaXMua2V5UGFpciA9IGF3YWl0IHRoaXMuYXV0aC5yZWdpc3RlcihoYW5kbGUsIHBhc3N3b3JkLCBlbWFpbCk7XG4gICAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVVzZXIoaGFuZGxlKTtcbiAgICB9XG4gICAgYXN5bmMgbG9nb3V0KCkge1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ1dJRicpO1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ0hBTkRMRScpO1xuICAgIH1cbiAgICBhc3luYyBvbkNsaWVudEV2ZW50KGV2ZW50KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHt9O1xuICAgICAgICBpZiAoIXRoaXMudHJ5UGFyc2VNZXNzYWdlRGF0YShldmVudC5kYXRhLCBtZXNzYWdlKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKFsnUmVnaXN0ZXInLCAnTG9naW4nXS5pbmNsdWRlcyhtZXNzYWdlLm5hbWUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgV0FMTEVUIFJFQ0VJVkVEIEVWRU5UOmAsIG1lc3NhZ2UubmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgV0FMTEVUIFJFQ0VJVkVEIEVWRU5UOmAsIEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHtcbiAgICAgICAgICAgIG5hbWU6IGBPbiR7bWVzc2FnZS5uYW1lfWBcbiAgICAgICAgfTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBtZXNzYWdlLnBheWxvYWQgJiYgSlNPTi5wYXJzZShtZXNzYWdlLnBheWxvYWQpO1xuICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdSZWdpc3Rlcic6XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucmVnaXN0ZXIocGF5bG9hZC5oYW5kbGUsIHBheWxvYWQucGFzc3dvcmQsIHBheWxvYWQuZW1haWwpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdMb2dpbic6XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9naW4ocGF5bG9hZC5oYW5kbGUsIHBheWxvYWQucGFzc3dvcmQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdMb2dvdXQnOlxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdDYXNob3V0JzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLndhbGxldClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignV2FsbGV0IG5vdCBpbml0aWFsaXplZCcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCB0aGlzLndhbGxldC5jYXNob3V0KHBheWxvYWQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsaWVudEVtaXQoJ0JhbGFuY2VVcGRhdGVkJywgMCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0lzSGFuZGxlQXZhaWxhYmxlJzpcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KGF3YWl0IHRoaXMuYXV0aC5pc0hhbmRsZUF2YWlsYWJsZShwYXlsb2FkKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5hZ2VudClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQWdlbnQgbm90IGluaXRpYWxpemVkJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0ICgoX2EgPSB0aGlzLmFnZW50KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eub25FdmVudChtZXNzYWdlLm5hbWUsIHBheWxvYWQpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucGF5bG9hZCA9IHJlc3VsdCAmJiBKU09OLnN0cmluZ2lmeShyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzcG9uc2Uuc3VjY2VzcyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHJlc3BvbnNlLnBheWxvYWQgPSBKU09OLnN0cmluZ2lmeShlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgaWYgKGUubWVzc2FnZS5pbmNsdWRlcygnTm90IGVub3VnaCBmdW5kcycpKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9IDQwMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSBlLnN0YXR1cyB8fCA1MDA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UubmFtZSwgcmVzcG9uc2UucGF5bG9hZCk7XG4gICAgICAgIHRoaXMucG9zdE1lc3NhZ2UocmVzcG9uc2UpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHRyeVBhcnNlTWVzc2FnZURhdGEoZGF0YSwgb3V0QnlSZWYpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IChvdXRCeVJlZiB8fCB7fSk7XG4gICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obWVzc2FnZSwgSlNPTi5wYXJzZShCdWZmZXIuZnJvbShkYXRhLCAnYmFzZTY0JykudG9TdHJpbmcoKSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWVzc2FnZSAmJiBtZXNzYWdlLm5hbWU7XG4gICAgfVxuICAgIGNsaWVudEVtaXQobmFtZSwgcGF5bG9hZCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZygnRW1pdHRpbmcnLCBuYW1lLCBwYXlsb2FkICYmIEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkICYmIEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLFxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxvZ3MucHVzaCh7XG4gICAgICAgICAgICBpZHg6IHRoaXMubG9nSWQrKyxcbiAgICAgICAgICAgIHNlc3Npb25JZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICBoYW5kbGU6IHRoaXMuaGFuZGxlLFxuICAgICAgICAgICAgdHlwZTogJ2xvZycsXG4gICAgICAgICAgICB0czogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgIHBheWxvYWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9zdE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgfVxuICAgIHBvc3RNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAgICAgbWVzc2FnZS50YXJnZXQgPSAna3Jvbm92ZXJzZSc7XG4gICAgICAgIGlmICh0aGlzLmlzSW5Vbml0eSkge1xuICAgICAgICAgICAgdGhpcy5jaGFubmVsLnBvc3RNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY2hhbm5lbFNjb3BlKSB7XG4gICAgICAgICAgICB0aGlzLmNoYW5uZWwucGFyZW50LnBvc3RNZXNzYWdlKG1lc3NhZ2UsIHRoaXMuY2hhbm5lbFNjb3BlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvdmVycmlkZUNvbnNvbGUoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nID0gKC4uLm1lc3NhZ2VzKSA9PiB7XG4gICAgICAgICAgICBtZXNzYWdlcy51bnNoaWZ0KERhdGUubm93KCkpO1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IG1lc3NhZ2VzLmpvaW4oJyAnKTtcbiAgICAgICAgICAgIHRoaXMubG9ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZHg6IHRoaXMubG9nSWQrKyxcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIHBheW1haWw6IHRoaXMucGF5bWFpbCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnbG9nJyxcbiAgICAgICAgICAgICAgICB0czogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChub2RlX2NvbmZpZ190c18xLmNvbmZpZy5lbWl0TG9ncylcbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudEVtaXQoJ0xvZycsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgdGhpcy5wcmludExvZyguLi5tZXNzYWdlcyk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnNvbGUuZXJyb3IgPSAoLi4ubWVzc2FnZXMpID0+IHtcbiAgICAgICAgICAgIG1lc3NhZ2VzLnVuc2hpZnQoRGF0ZS5ub3coKSk7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZXMuam9pbignICcpO1xuICAgICAgICAgICAgdGhpcy5sb2dzLnB1c2goe1xuICAgICAgICAgICAgICAgIGlkeDogdGhpcy5sb2dJZCsrLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgcGF5bWFpbDogdGhpcy5wYXltYWlsLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgdHM6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgbWVzc2FnZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAobm9kZV9jb25maWdfdHNfMS5jb25maWcuZW1pdExvZ3MpXG4gICAgICAgICAgICAgICAgdGhpcy5jbGllbnRFbWl0KCdFcnJvcicsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgdGhpcy5wcmludEVycm9yKC4uLm1lc3NhZ2VzKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS50aW1lID0gKGxhYmVsKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRpbWVMYWJlbHNbbGFiZWxdID0gRGF0ZS5ub3coKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS50aW1lRW5kID0gKGxhYmVsKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtsYWJlbH06ICR7RGF0ZS5ub3coKSAtIHRoaXMudGltZUxhYmVsc1tsYWJlbF0gfHwgMH1tc2ApO1xuICAgICAgICB9O1xuICAgIH1cbn1cbmV4cG9ydHMuV2FsbGV0U2VydmljZSA9IFdhbGxldFNlcnZpY2U7XG4iXSwic291cmNlUm9vdCI6IiJ9